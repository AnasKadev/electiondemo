<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/voting/servlets/deleteElection.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/voting/servlets/deleteElection.java" />
              <option name="originalContent" value="package com.voting.servlets;&#10;&#10;import com.voting.entities.Election;&#10;import com.voting.entities.User;&#10;import com.voting.util.HibernateUtil;&#10;import jakarta.servlet.ServletException;&#10;import jakarta.servlet.annotation.WebServlet;&#10;import jakarta.servlet.http.HttpServlet;&#10;import jakarta.servlet.http.HttpServletRequest;&#10;import jakarta.servlet.http.HttpServletResponse;&#10;import org.hibernate.Session;&#10;import org.hibernate.Transaction;&#10;&#10;import java.io.IOException;&#10;&#10;@WebServlet(&quot;/deleteElection&quot;)&#10;public class deleteElection extends HttpServlet {&#10;&#10;    @Override&#10;    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {&#10;        String idParam = request.getParameter(&quot;id&quot;);&#10;&#10;        User user = (User) request.getSession().getAttribute(&quot;user&quot;);&#10;        if (user == null || !&quot;ADMIN&quot;.equals(user.getRole())) {&#10;            response.sendRedirect(&quot;login.jsp&quot;);&#10;            return;&#10;        }&#10;&#10;        try {&#10;            Long electionId = Long.parseLong(idParam);&#10;&#10;            try (Session session = HibernateUtil.getSessionFactory().openSession()) {&#10;                Transaction tx = session.beginTransaction();&#10;&#10;                Election election = session.get(Election.class, electionId);&#10;                if (election != null) {&#10;                    // Supprimer l'élection (Hibernate gérera la suppression en cascade des candidats et votes)&#10;                    session.remove(election);&#10;                    tx.commit();&#10;                    request.getSession().setAttribute(&quot;message&quot;, &quot;Élection supprimée avec succès&quot;);&#10;                } else {&#10;                    request.getSession().setAttribute(&quot;error&quot;, &quot;Élection non trouvée&quot;);&#10;                }&#10;            } catch (Exception e) {&#10;                request.getSession().setAttribute(&quot;error&quot;, &quot;Erreur lors de la suppression : &quot; + e.getMessage());&#10;            }&#10;&#10;        } catch (NumberFormatException e) {&#10;            request.getSession().setAttribute(&quot;error&quot;, &quot;ID d'élection invalide&quot;);&#10;        }&#10;&#10;        // Redirection vers le tableau de bord admin&#10;        response.sendRedirect(&quot;admin/dashboard.jsp&quot;);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.voting.servlets;&#10;&#10;import com.voting.entities.Election;&#10;import com.voting.entities.User;&#10;import com.voting.util.HibernateUtil;&#10;import jakarta.servlet.ServletException;&#10;import jakarta.servlet.annotation.WebServlet;&#10;import jakarta.servlet.http.HttpServlet;&#10;import jakarta.servlet.http.HttpServletRequest;&#10;import jakarta.servlet.http.HttpServletResponse;&#10;import org.hibernate.Session;&#10;import org.hibernate.Transaction;&#10;&#10;import java.io.IOException;&#10;&#10;@WebServlet(&quot;/admin/deleteElection&quot;)&#10;public class DeleteElection extends HttpServlet {&#10;&#10;    @Override&#10;    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {&#10;        String idParam = request.getParameter(&quot;id&quot;);&#10;&#10;        User user = (User) request.getSession().getAttribute(&quot;user&quot;);&#10;        if (user == null || !&quot;ADMIN&quot;.equals(user.getRole())) {&#10;            response.sendRedirect(&quot;../login.jsp&quot;);&#10;            return;&#10;        }&#10;&#10;        try {&#10;            Long electionId = Long.parseLong(idParam);&#10;&#10;            try (Session session = HibernateUtil.getSessionFactory().openSession()) {&#10;                Transaction tx = session.beginTransaction();&#10;&#10;                Election election = session.get(Election.class, electionId);&#10;                if (election != null) {&#10;                    // Supprimer l'élection (Hibernate gérera la suppression en cascade des candidats et votes)&#10;                    session.remove(election);&#10;                    tx.commit();&#10;                    request.getSession().setAttribute(&quot;message&quot;, &quot;Élection supprimée avec succès&quot;);&#10;                } else {&#10;                    request.getSession().setAttribute(&quot;error&quot;, &quot;Élection non trouvée&quot;);&#10;                }&#10;            } catch (Exception e) {&#10;                request.getSession().setAttribute(&quot;error&quot;, &quot;Erreur lors de la suppression : &quot; + e.getMessage());&#10;            }&#10;&#10;        } catch (NumberFormatException e) {&#10;            request.getSession().setAttribute(&quot;error&quot;, &quot;ID d'élection invalide&quot;);&#10;        }&#10;&#10;        // Redirection vers le tableau de bord admin&#10;        response.sendRedirect(&quot;dashboard.jsp&quot;);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>